(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{223:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"optional-components-reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optional-components-reference"}},[t._v("#")]),t._v(" Optional-components reference")]),t._v(" "),a("p",[t._v("If you havent read it, you should read about "),a("a",{attrs:{href:"./plugins"}},[t._v("plugins")]),t._v(" first")]),t._v(" "),a("h2",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("You must use dynaconf merge when changing these parameters.. Example")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("myenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTIONAL_COMPONENTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dynaconf_merge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("WALRUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-walrus"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis://redis"')]),t._v("\n")])])])]),t._v(" "),a("p",[t._v("Take a look at the default configuration "),a("a",{attrs:{href:"https://github.com/opa-stack/opa-stack/blob/master/api/data/opa/default-settings.yaml",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(" or see the file below (it is under the "),a("code",[t._v("OPTIONAL_COMPONENTS")]),t._v(" key) for some examples.")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("default-settings.yaml")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MODE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prod"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PROJECT_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"opa-stack"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PROJECT_DESCRIPTION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PROJECT_VERSION")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.1.0"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Urls to automatic documentation. Set to null to disable")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DOCS_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/docs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("REDOC_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/redoc"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPENAPI_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/openapi.json"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Can only be null if DOCS_URL and REDOC_URL is also null")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPENAPI_PREFIX")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_PATHS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_WHITELIST_LIST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_WHITELIST_RE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_WHITELIST_TAGS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_BLACKLIST_LIST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_BLACKLIST_RE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_BLACKLIST_TAGS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CORS")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ALLOW_ORIGINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ALLOW_CREDENTIALS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ALLOW_METHODS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ALLOW_HEADERS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SECRET_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configuration for optional components..")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# They all have a helper-file in ../utils/{component_name.lower()}.py, so check")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# in them if you wonder how these values are used. They are also listed in the docs")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# @ https://opa-stack.github.io/guide/components.html")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The LOAD option is always present, and can be one of auto|yes|no, all defaulting to 'auto'.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   * auto: Makes opa-stack look for the component using a simple dns-check or other simple checks")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#           Ie.. Check if we "should" be able to use this component.')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#           It will then try to connect as if you had written "yes", ie, it fails if it is not able to..')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   * yes: Makes the coponent required")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   * no: Makes it not check at all.")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTIONAL_COMPONENTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MONGODB")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb-async-motor"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://mongo:mongo@mongo:27017/opa"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("WALRUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-walrus"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis://redis"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AIOREDIS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-aioredis"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis://redis"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CELERY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LOAD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auto"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DRIVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"celery"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BACKEND_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis://redis/1"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BROKER_URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pyamqp://guest@rabbitmq//"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Used different places, currently:")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  * Setting FastAPI/Starlette debug-mode (https://www.starlette.io/applications/)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DEBUG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Turns on better exceptions, ie, prettier, and with some more info (like variables)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BETTER_EXCEPTIONS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Python Tools for Visual Studio debug server, running on port 5678")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PTVSD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# External js files are loaded from the internet as default")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SELF_HOSTED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dev")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MODE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PTVSD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BETTER_EXCEPTIONS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BETTER_EXCEPTIONS_MAX_LENGTH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PLUGIN_PATHS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/opa/demo-plugins"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dynaconf_merge\n")])])])]),t._v(" "),a("h2",{attrs:{id:"usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),a("p",[t._v("When you want to use an optional-component you the best way is to use "),a("code",[t._v("opa.get_instance(name)")]),t._v(" like this")]),t._v(" "),a("div",{staticClass:"language-py extra-class"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opa "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" get_instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" get_router\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driver_redis "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Walrus\n\nrouter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("counter_sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    walrus "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_intance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'walrus'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    counter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" walrus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("incr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'counter'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'Counter is ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'")])]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[a("code",[t._v("opa.get_instance()")]),t._v(" takes the lowercase component key-name as input")])]),t._v(" "),a("p",[t._v("The other ways to get the instance (might be usefull in some cases)")]),t._v(" "),a("ul",[a("li",[t._v("Use "),a("code",[t._v("component = opa.get_component(name)")]),t._v(" "),a("ul",[a("li",[t._v("The instance will be under "),a("code",[t._v("component.instance")]),t._v(", but there are other component-info you might want under "),a("code",[t._v("component")])])])]),t._v(" "),a("li",[t._v("Use "),a("code",[t._v("pm = opa.get_plugin_manager()")]),t._v(", then "),a("code",[t._v("pm.optional_components[name]")]),t._v(" to get the component instance")])]),t._v(" "),a("h2",{attrs:{id:"drivers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#drivers"}},[t._v("#")]),t._v(" Drivers")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Backend")]),t._v(" "),a("th",[t._v("Library")]),t._v(" "),a("th",[t._v("Drivername")]),t._v(" "),a("th",[t._v("Async")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Redis")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://aioredis.readthedocs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Aioredis"),a("OutboundLink")],1)]),t._v(" "),a("td",[a("a",{attrs:{href:"#aioredis"}},[t._v("redis-aioredis")])]),t._v(" "),a("td",[t._v("yes")])]),t._v(" "),a("tr",[a("td",[t._v("Redis")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://walrus.readthedocs.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Walrus"),a("OutboundLink")],1)]),t._v(" "),a("td",[a("a",{attrs:{href:"#walrus"}},[t._v("redis-walrus")])]),t._v(" "),a("td",[t._v("no")])]),t._v(" "),a("tr",[a("td",[t._v("Mongodb")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://motor.readthedocs.io/en/stable/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Motor"),a("OutboundLink")],1)]),t._v(" "),a("td",[a("a",{attrs:{href:"#motor"}},[t._v("mongodb-async-motor")])]),t._v(" "),a("td",[t._v("yes")])]),t._v(" "),a("tr",[a("td",[t._v("Celery")]),t._v(" "),a("td",[a("a",{attrs:{href:"http://www.celeryproject.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Celery"),a("OutboundLink")],1)]),t._v(" "),a("td",[a("a",{attrs:{href:"#celery"}},[t._v("celery")])]),t._v(" "),a("td",[t._v("no")])])])]),t._v(" "),a("h3",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[t._v("#")]),t._v(" Redis")]),t._v(" "),a("h4",{attrs:{id:"aioredis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aioredis"}},[t._v("#")]),t._v(" Aioredis")]),t._v(" "),a("h4",{attrs:{id:"walrus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#walrus"}},[t._v("#")]),t._v(" Walrus")]),t._v(" "),a("ul",[a("li",[t._v("Very powerful redis library with support for a lot of additional features")])]),t._v(" "),a("h3",{attrs:{id:"mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[t._v("#")]),t._v(" Mongodb")]),t._v(" "),a("h4",{attrs:{id:"motor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motor"}},[t._v("#")]),t._v(" Motor")]),t._v(" "),a("h3",{attrs:{id:"celery-tasks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#celery-tasks"}},[t._v("#")]),t._v(" Celery / tasks")]),t._v(" "),a("p",[t._v("If you need basic background tasks, look into "),a("a",{attrs:{href:"https://fastapi.tiangolo.com/tutorial/background-tasks/",target:"_blank",rel:"noopener noreferrer"}},[t._v("FastAPI/Starlette BackgroundTasks"),a("OutboundLink")],1),t._v(" instead.")]),t._v(" "),a("p",[t._v("There is builtin support for running celery tasks, see the "),a("a",{attrs:{href:"https://github.com/opa-stack/opa-stack/tree/master/examples/docker-compose/celery-task",target:"_blank",rel:"noopener noreferrer"}},[t._v("sample-project"),a("OutboundLink")],1),t._v(" for details, view info about the sample project "),a("RouterLink",{attrs:{to:"/guide/examples.html#celery-task"}},[t._v("here")])],1),t._v(" "),a("p",[t._v("The opa-stack's api-container can run in "),a("code",[t._v("worker mode")]),t._v(", ie, it will run a celery worker with the same codebase as the rest of the api. This is by far the simplest setup, but feel free to run your own workers if you need.")]),t._v(" "),a("ul",[a("li",[t._v("Set environment-variable "),a("code",[t._v("MODE=worker")]),t._v(" to start it as a worker")]),t._v(" "),a("li",[t._v("Set additional celery params ("),a("code",[t._v("celery worker -A opa.main ${CELERY_PARAMS}")]),t._v(")")])]),t._v(" "),a("p",[t._v("Some important notes about using celery in opa-stack is:")]),t._v(" "),a("ul",[a("li",[t._v("The tasks must be defined in "),a("code",[t._v("tasks.py")]),t._v(", ie, you will need your plugin to be a python package (folder with "),a("code",[t._v("__init__.py")]),t._v(").")]),t._v(" "),a("li",[t._v("You can access optional-components as usual in the tasks, but only non-async drivers are working. Ie, you can't use drivers like "),a("code",[t._v("motor")]),t._v(" or "),a("code",[t._v("aioredis")]),t._v(" in your tasks.\n"),a("ul",[a("li",[t._v("It is important that you DONT import any of your tasks on top of the file where your route is defined. Ie, do the "),a("code",[t._v("from packagename.tasks import sometask")]),t._v(" inside your "),a("code",[t._v("@router.get('/')...")]),t._v(" function!")])])]),t._v(" "),a("li",[t._v("The celery worker is using most of the opa-stack code. So configuration, driver-loading, hooks and so on will also work in the celery worker.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);